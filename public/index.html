<!-- public/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puter.js AI API on Vercel</title>
    <script src="https://js.puter.com/v2/"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; }
        textarea { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; height: 100px; }
        button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:disabled { background: #ccc; }
        #response { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; display: none; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Puter.js AI REST API (Hosted on Vercel)</h1>
    <textarea id="promptInput" placeholder="e.g., What is the capital of France?"></textarea>
    <button id="submitBtn">Get AI Response and Send to Server</button>

    <h3>AI Response:</h3>
    <div id="response"></div>

    <script>
        const promptInput = document.getElementById('promptInput');
        const submitBtn = document.getElementById('submitBtn');
        const responseDiv = document.getElementById('response');

        // *** CHANGE THIS LINE ***
        // Use a relative path for the API endpoint.
        const YOUR_SERVER_API_ENDPOINT = '/api/ai-response';

        submitBtn.addEventListener('click', async () => {
            const prompt = promptInput.value;
            if (!prompt) return;

            submitBtn.disabled = true;
            submitBtn.textContent = 'Getting AI Response...';
            responseDiv.style.display = 'none';

            try {
                const aiResponse = await puter.ai.chat(prompt, { model: 'gpt-4.1-nano' });
                const responseText = aiResponse.message.content;
                responseDiv.textContent = responseText;
                responseDiv.style.display = 'block';

                submitBtn.textContent = 'Sending to Server...';

                const serverResponse = await fetch(YOUR_SERVER_API_ENDPOINT, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        originalPrompt: prompt,
                        aiResponse: responseText
                    }),
                });

                if (!serverResponse.ok) throw new Error(`Server error: ${serverResponse.statusText}`);

                const result = await serverResponse.json();
                console.log('Server confirmation:', result);
                alert('AI response successfully sent to the Vercel server!');

            } catch (error) {
                console.error('An error occurred:', error);
                alert(`Error: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Get AI Response and Send to Server';
            }
        });
    </script>
</body>
</html>
